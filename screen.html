<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>

body {
  background: #f00;
}

</style>
</head>
<body>

<!--
<div id="create">Create</div>
<textarea></textarea>
<div id="start">Start</div>
-->

<script>


(function() {

  let secs = -1
  //let serverId = -1

  // Websocket stuff - JBG

  //const ws = new WebSocket('wss://winwin.peerparty.org/ws/')
  const ws = new WebSocket('ws://localhost:8000/')

  ws.onopen = function(e) {
    console.log('Websocket open.')
    ws.send(JSON.stringify({ cmd: 'SCREEN_JOIN' }))
  }

  ws.onclose = function(e) {
    console.log('Websocket closed.')
  }

  ws.onerror = function(e) {
    console.log('Websocket errored.')
  }

  ws.onmessage = function(e) {
    console.log(e.data)
    const res = JSON.parse(e.data)
    const cmd = res['cmd']
    switch(cmd) {
      case 'SCREEN_INIT':
        console.log('SERVER ID:', res['id'])
        console.log('data:', res['data'])
        console.log('start_time:', res['start_time'])
        secs = parseInt(res['start_time'] - (new Date().getTime() / 1000))
        break
      case 'SCREEN_CONSENSUS':
        console.log('CONSENSUS:', res['data'])
        break
      case 'SCREEN_START':
        console.log('Session is starting...')
        break
      case 'SCREEN_TREE':
        console.log('New Discussion Tree')
        break
      case 'SCREEN_NOT_ENOUGH':
        console.log('Not enough users...')
        break
      default:
        console.log('Unknown CMD: ' + cmd)
        break
    }
  }

  setInterval(() => {
    secs -= 1
    console.log(`Starts in ${secs} seconds`)
  }, 1000)

})()

</script>
</body>
</html>


